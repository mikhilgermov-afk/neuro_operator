# Ì†æÌ¥ñ AI Voice Bot: Asterisk + vLLM + F5-TTS

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –±–æ—Ç–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IP-—Ç–µ–ª–µ—Ñ–æ–Ω–∏–µ–π (Asterisk) —á–µ—Ä–µ–∑ RTP. –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç —Ä–µ—á—å, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å –ø–æ–º–æ—â—å—é LLM –∏ –æ–∑–≤—É—á–∏–≤–∞–µ—Ç –µ–≥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–æ–ª–æ—Å–æ–º —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.



## Ì†ΩÌ∫Ä –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* **–ü–æ–ª–Ω—ã–π –¥—É–ø–ª–µ–∫—Å —á–µ—Ä–µ–∑ RTP:** –ù–∞—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å UDP-–ø–∞–∫–µ—Ç–∞–º–∏, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `seq_num` –∏ `timestamp`.
* **–£–º–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –∞—É–¥–∏–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥ 8kHz (—Ç–µ–ª–µ—Ñ–æ–Ω–∏—è) ‚Üî 16kHz (AI-–º–æ–¥–µ–ª–∏) ¬´–Ω–∞ –ª–µ—Ç—É¬ª.
* **F5-TTS (Patched):**
    * –í–Ω–µ–¥—Ä–µ–Ω **–∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–∞—Ç—á –ø–∞–º—è—Ç–∏** (Sinusoidal Positional Embeddings), –∏—Å–ø—Ä–∞–≤–ª—è—é—â–∏–π –∫—Ä–∞—à–∏ –∏ –∑–∞–≤–∏—Å–∞–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–∞—Ö.
    * –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (Float32) –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.
    * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–≥–æ –∞—É–¥–∏–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ VRAM.
* **vLLM Inference:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `vLLM` —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ (Qwen 2.5).
* **Faster-Whisper:** –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –Ω–∞ GPU.
* **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ú–æ–¥–µ–ª–∏ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker Volumes.

## Ì†ΩÌª† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **–Ø–∑—ã–∫:** Python 3.10+
* **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è:** Docker Compose
* **STT:** `faster-whisper` (large-v3-turbo)
* **LLM:** `Qwen/Qwen2.5-7B-Instruct` (via vLLM)
* **TTS:** `F5-TTS` (Russian finetune)
* **Telephony:** Raw RTP (G.711 u-law)

## Ì†ΩÌ≥¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # RTP —Å–µ—Ä–≤–µ—Ä, VAD –ª–æ–≥–∏–∫–∞, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ tts_engine.py    # –û–±–µ—Ä—Ç–∫–∞ F5-TTS —Å –ø–∞—Ç—á–∞–º–∏ –ø–∞–º—è—Ç–∏ –∏ —Ç–∏–ø–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ prompts.py       # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM
‚îÇ   ‚îî‚îÄ‚îÄ ref_audio.wav    # –†–µ—Ñ–µ—Ä–µ–Ω—Å –≥–æ–ª–æ—Å–∞ (5-10 —Å–µ–∫)
‚îú‚îÄ‚îÄ models/              # –ü–∞–ø–∫–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞ –º–æ–¥–µ–ª–µ–π (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ docker-compose.yml   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ Dockerfile           # –°–±–æ—Ä–∫–∞ Voice Bot
‚îú‚îÄ‚îÄ .env                 # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–µ–∫—Ä–µ—Ç—ã)
‚îî‚îÄ‚îÄ .gitignore           # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git

##Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

    Linux —Å–µ—Ä–≤–µ—Ä —Å NVIDIA GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 24GB+ VRAM, –Ω–∞–ø—Ä–∏–º–µ—Ä L40S, A10G, 3090, 4090).

    –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã NVIDIA –∏ nvidia-container-toolkit.

    Docker & Docker Compose.

2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
Bash

git clone <your-repo-url>
cd voice-bot

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π (—á—Ç–æ–±—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Docker –±—ã–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏)
mkdir -p models/llm
mkdir -p models/voice

3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
Bash

# –¢–æ–∫–µ–Ω HuggingFace (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥–µ–ª—è–º —Ç–∏–ø–∞ Llama/Qwen/F5)
HF_TOKEN=your_hf_token_here

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ URL (–æ–±—ã—á–Ω–æ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ docker network)
LLM_API_URL=http://llm-server:8085/v1

–í–∞–∂–Ω–æ: –ü–æ–ª–æ–∂–∏—Ç–µ —Ñ–∞–π–ª —Å –æ–±—Ä–∞–∑—Ü–æ–º –≥–æ–ª–æ—Å–∞ (wav, –º–æ–Ω–æ) –≤ app/ref_audio.wav. –ë–æ—Ç –±—É–¥–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å —ç—Ç–∏–º –≥–æ–ª–æ—Å–æ–º.
4. –ó–∞–ø—É—Å–∫
Bash

docker compose up -d --build

–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–π–º–µ—Ç –≤—Ä–µ–º—è, —Ç–∞–∫ –∫–∞–∫ –±—É–¥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è –≤–µ—Å–∞ –º–æ–¥–µ–ª–µ–π (Qwen ~15GB, Whisper ~3GB, F5 ~8GB). –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏:
Bash

docker compose logs -f voice-bot

–ö–æ–≥–¥–∞ —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚úÖ SYSTEM READY. Listening RTP on 0.0.0.0:10000, –±–æ—Ç –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–≤–æ–Ω–∫–∏.
Ì†ΩÌ≥û –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Asterisk

–ë–æ—Ç –æ–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–π RTP –ø–æ—Ç–æ–∫ (G.711 u-law, 8000Hz) –Ω–∞ –ø–æ—Ä—Ç 10000.

–ü—Ä–∏–º–µ—Ä (FreePBX / Dialplan): –í–∞–º –Ω—É–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å RTP –ø–æ—Ç–æ–∫ –Ω–∞ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ —Å –±–æ—Ç–æ–º. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å External Media –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π Dialplan, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π UnicastRTP.
Ì†ΩÌ∞õ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º (Troubleshooting)

1. –ë–æ—Ç "–º–æ–ª—á–∏—Ç" –≤ —Ç—Ä—É–±–∫—É.

    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –∏–¥–µ—Ç –ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (Ì†ΩÌ∑£Ô∏è User: ...)?

    –ï—Å–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç –∑–≤—É–∫–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–∫—Ä—ã—Ç—ã –ª–∏ UDP –ø–æ—Ä—Ç—ã 10000-10001 –Ω–∞ —Ñ–∞–µ—Ä–≤–æ–ª–µ —Å–µ—Ä–≤–µ—Ä–∞.

    –ï—Å–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –Ω–µ—Ç (–ø—É—Å—Ç—ã–µ —Å–∫–æ–±–∫–∏): –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ–∫–∞—Ö. –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ u-law (PCMU).

2. –û—à–∏–±–∫–∞ "Generation failed: Input type complex..."

    –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é tts_engine.py –∏–∑ —ç—Ç–æ–≥–æ —Ä–µ–ø–æ. –ú—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–∏–ø–æ–≤ Float32/Complex64 –≤ –ø–∞—Ç—á–µ –ø–∞–º—è—Ç–∏.

3. OOM (Out of Memory) Error

    –í docker-compose.yml –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ llm-server –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä --gpu-memory-utilization 0.6. –ï—Å–ª–∏ —É –≤–∞—Å –º–∞–ª–æ –ø–∞–º—è—Ç–∏, —É–º–µ–Ω—å—à–∏—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ 0.4 –∏–ª–∏ 0.5, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ –¥–ª—è TTS –∏ Whisper.